<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="ios,iap,receipt,shell,curl," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="以前写的一个iap reciept脚本验证工具。完全借助操作系统自带的工具。">
<meta name="keywords" content="ios,iap,receipt,shell,curl">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS IAP receipt 验证脚本">
<meta property="og:url" content="http://eriklu.github.io/2014/12/10/2014-12-10-iOS IAP receipt 验证脚本/index.html">
<meta property="og:site_name" content="弦歌雅意的小屋">
<meta property="og:description" content="以前写的一个iap reciept脚本验证工具。完全借助操作系统自带的工具。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-08-08T06:48:20.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS IAP receipt 验证脚本">
<meta name="twitter:description" content="以前写的一个iap reciept脚本验证工具。完全借助操作系统自带的工具。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://eriklu.github.io/2014/12/10/2014-12-10-iOS IAP receipt 验证脚本/"/>





  <title>iOS IAP receipt 验证脚本 | 弦歌雅意的小屋</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">弦歌雅意的小屋</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://eriklu.github.io/2014/12/10/2014-12-10-iOS IAP receipt 验证脚本/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Erik Lu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="弦歌雅意的小屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">iOS IAP receipt 验证脚本</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-12-10T08:00:00+08:00">
                2014-12-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>以前写的一个iap reciept脚本验证工具。完全借助操作系统自带的工具。</p>
<a id="more"></a>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"><span class="comment">#echo $#</span></div><div class="line"><span class="comment">#把一个App App Store的IPA返回的recipt的二进制格式文件发往服务器验证</span></div><div class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ]  </div><div class="line"><span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"need a file as argment"</span> </div><div class="line">   <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">else</span></div><div class="line">   <span class="keyword">if</span> [ -f <span class="variable">$1</span> ] ; <span class="keyword">then</span></div><div class="line">       base64Str=`base64 <span class="variable">$1</span>`</div><div class="line">       param=`<span class="built_in">printf</span> &#123;\<span class="string">"receipt-data\":\"%s\"&#125; <span class="variable">$&#123;base64Str&#125;</span>`</span></div><div class="line"><span class="string">       echo "</span>base64编码格式内容<span class="string">"</span></div><div class="line"><span class="string">       echo <span class="variable">$&#123;param&#125;</span></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">       echo "</span>================ 发往生产服务器验证 =========================<span class="string">"</span></div><div class="line"><span class="string">       curl -d <span class="variable">$&#123;param&#125;</span> "</span>https://buy.itunes.apple.com/verifyReceipt<span class="string">"</span></div><div class="line"><span class="string">       echo "</span><span class="string">"</span></div><div class="line"><span class="string">       echo "</span>================ 发往测试服务器验证 =========================<span class="string">"</span></div><div class="line"><span class="string">       curl -d <span class="variable">$&#123;param&#125;</span> "</span>https://sandbox.itunes.apple.com/verifyReceipt<span class="string">"</span></div><div class="line"><span class="string">       echo "</span>================ 状态码解释 ================================<span class="string">"</span></div><div class="line"><span class="string">       echo "</span>status     0 : Success.<span class="string">"</span></div><div class="line"><span class="string">       echo "</span>status 21000 : The App Store could not <span class="built_in">read</span> the JSON object you provided.<span class="string">"</span></div><div class="line"><span class="string">       echo "</span>status 21002 : The data <span class="keyword">in</span> the receipt-data property was malformed.<span class="string">"</span></div><div class="line"><span class="string">       echo "</span>status 21003 : The receipt could not be authenticated.<span class="string">"</span></div><div class="line"><span class="string">       echo "</span>status 21004 : status The shared secret you provided does not match the shared secret on file <span class="keyword">for</span> your account.<span class="string">"</span></div><div class="line"><span class="string">       echo "</span>status 21005 : The receipt server is not currently available.<span class="string">"</span></div><div class="line"><span class="string">       echo "</span>status 21006 : This receipt is valid but the subscription has expired. When this status code is returned to your server, the receipt data is also decoded and returned as part of the response.<span class="string">"</span></div><div class="line"><span class="string">       echo "</span>status 21007 : This receipt is a sandbox receipt, but it was sent to the production service <span class="keyword">for</span> verification.<span class="string">"</span></div><div class="line"><span class="string">       echo "</span>status 21008 : This receipt is a production receipt, but it was sent to the sandbox service <span class="keyword">for</span> verification.<span class="string">"</span></div><div class="line"><span class="string">    else</span></div><div class="line"><span class="string">        echo "</span>文件<span class="variable">$1</span>不存在<span class="string">"</span></div><div class="line"><span class="string">    fi </span></div><div class="line"><span class="string">fi</span></div></pre></td></tr></table></figure>
<p><a href="https://raw.githubusercontent.com/eriklu/eriklu.github.io/master/resources/iap_receipt_valid.sh" target="_blank" rel="external">下载脚本文件</a><br><a href="https://raw.githubusercontent.com/eriklu/eriklu.github.io/master/resources/iap_receipt_example.dat" target="_blank" rel="external">下载iap receipt文件例子</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ios/" rel="tag"># ios</a>
          
            <a href="/tags/iap/" rel="tag"># iap</a>
          
            <a href="/tags/receipt/" rel="tag"># receipt</a>
          
            <a href="/tags/shell/" rel="tag"># shell</a>
          
            <a href="/tags/curl/" rel="tag"># curl</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2014/12/09/2014-12-09-语法错误导致文章不能显示/" rel="next" title="语法错误导致文章不能显示">
                <i class="fa fa-chevron-left"></i> 语法错误导致文章不能显示
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2014/12/12/2014-12-12-系统头文件被修改导致项目不能编译/" rel="prev" title="系统头文件被修改导致项目不能编译。">
                系统头文件被修改导致项目不能编译。 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Erik Lu" />
          <p class="site-author-name" itemprop="name">Erik Lu</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">71</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">38</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">78</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Erik Lu</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
